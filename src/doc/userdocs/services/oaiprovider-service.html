<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
  <title>OAI Provider Service</title>


  <link rel="stylesheet" type="text/css" href="../docstyle.css" />

</head>




<body>

<div id="header"> 
<div id="title">
<h1>OAI Provider Service</h1>

<h2>Fedora Release 2.1</h2>

<br />

</div>

</div>

<div class="toc">
<h2>Table of Contents</h2>

<div class="tocbox">
<ol>

  <li><a href="#about">About This Service</a></li>

  <li><a href="#installation">Installation</a></li>

  <li><a href="#demo">Demonstration Setup</a></li>

  <li><a href="#configuration">Configuration</a></li>

</ol>

</div>

</div>

<div class="sec1">
<div class="titlepage">
<div>
<h2 class="title" style="clear: both;"><a name="about"></a>About This Service</h2>

</div>

</div>

<p>The Fedora OAI Provider Service is part of the <a href="../server/features/serviceframework.htm">Fedora
Service Framework</a> and offers a vast improvement over the
previous, simple OAI provider that Fedora used in previous versions.
The new provider is based on <a href="http://www.sf.net/projects/proai/">Proai</a>, an
open source caching, polling OAI provider. It has the following
features: </p>

<ul>

  <li> Supports any metadata format available through your Fedora
repository via a datastream or dissemination.</li>

  <li> Supports sets that are expressed as RDF relationships in
your digital objects' RELS-EXT datastreams as exposed via the <a href="../server/resourceIndex/index.html">Resource Index</a>.</li>

  <li> Runs in its own servlet container, acting as a web service
client to Fedora.</li>

  <li> Caches the content of the Fedora disseminations and
datastreams intended to be exposed as OAI records. This makes for fast
response times and also ensures that the OAI provider can continue to
run even when Fedora is temporarily stopped.</li>

</ul>

<p> </p>

</div>

<div>
<div class="sec1">
<div class="titlepage">
<div>
<h2 class="title" style="clear: both;"><a name="installation"></a>Installation</h2>

</div>

</div>

<p>To install the service: </p>

<ol>

  <li> Make sure you have a suitable database installed (MySQL,
Oracle, or McKoi) and a database user account that can create tables in
the database.</li>

  <li> Make sure your Fedora repository is running with the
ResourceIndex turned ON. This is necessary because the oai provider
periodically queries the resource index to discover what records of
interest have changed.</li>

  <li> Deploy the oaiprovider.war file into your servlet
container.</li>

  <li> Configure the OAI provider as described in the
Configuration section below</li>

  <li>Re-start the webapp (this is often done by restarting the
servlet container itself).</li>

</ol>

</div>

</div>

<div>
<div class="sec1">
<div class="titlepage">
<div>
<div class="titlepage">
<div>
<span style="font-weight: bold;"><br />
</span>
<h2 class="title" style="clear: both;"><a name="demo"></a>Demonstration / Test Setup</h2>

The
source distribution of the OAI Provider Service includes several test
Fedora objects. &nbsp;You can use these object and the default
proai.properties configuration file to &nbsp;quickly get an idea
for how the service works.<br />

<ol>

  <li>Complete&nbsp;installation steps 1-4 above, using most
of the default values in the proai.properties configuration file, but
making sure that the following properties are set according to your own
Fedora installation:</li>

  <ul>

    <li>driver.fedora.baseURL</li>

    <li>driver.fedora.user</li>

    <li>driver.fedora.pass</li>

  </ul>

  <li>Make sure your Fedora installation is configured to retain
(rather than re-generate) PIDs of objects in the "demo" PID namespace
on ingest. &nbsp;You can check this in your fedora.fcfg file:
&nbsp;If one of the values of&nbsp;"retainPIDs" is "demo" or
"*" (asterisk), Fedora is configured correctly. &nbsp;Otherwise,
you should add this value and re-start Fedora.</li>

  <li>Use the fedora-admin GUI or fedora-ingest command-line
utility to ingest all foxml objects&nbsp;in the src/test/foxml
directory of the Fedora OAI Provider source distribution.</li>

  <li>Start the webapp.</li>

</ol>

Upon starting the webapp, the service will poll Fedora for objects that
provide oai record content and have changed since its last update.
&nbsp;It will find the objects you just ingested, request
appropriate disseminations of each, and save them in its cache.
&nbsp;Once it has successfully completed a cache update cycle, you
should be able to hit the front-end (where you installed the service)
with OAI-PMH verbs. &nbsp;Here are a couple examples:<br />
<br />

<div class="code">
<pre>http://localhost/oaiprovider/?verb=Identify<br />http://localhost/oaiprovider/?verb=ListRecords&amp;metadataPrefix=oai_dc<br /></pre>
</div>

<span style="font-weight: bold;"><br />
</span>Now try using fedora-admin to edit one of the datastreams of one
of the demo objects you just ingested. &nbsp;The next time the
oaiprovider service polls Fedora for modified records (the poll
frequency is 60 seconds by default,
see&nbsp;proai.driverPollSeconds&nbsp;below), it should pick up this
change and make it available via the front-end. <br />
<br />
<span style="font-weight: bold;"></span>
</div>

</div>

<h2 class="title" style="clear: both;"><a name="configuration"></a>Configuration</h2>

</div>

</div>

<p>By editing the <code>WEB-INF/classes/proai.properties</code>
file, you can configure the OAI provider in many different ways. See
the example configuration values and change them to match the
configuration you want.</p>

<p>The example configuration follows.</p>

<div class="code"><br />
<pre>#<br /># Proai Configuration <br /># ================================<br /><br />#######################<br /># Required Properties #<br />#######################<br /><br />proai.sessionBaseDir = /tmp/proai/sessions<br />proai.secondsBetweenRequests = 300<br />proai.incompleteRecordListSize = 2<br />proai.incompleteSetListSize = 2<br />proai.incompleteIdentifierListSize = 2<br /><br /># [proai.readLockWait]<br /># The number of milliseconds to wait for a read lock on the cache<br /># before giving up. A higher value means that OAI harvesters won't<br /># have to deal with "Service Unavailable" requests as often, whereas<br /># a lower value will result in quicker response.<br /><br />proai.readLockWait = 5000<br /><br /># [proai.writeLockWait]<br /># The number of milliseconds to wait for a write lock on the cache<br /># before giving up. If this amount of time passes while waiting<br /># to commit a change to the cache, the update will be canceled and<br /># attempted again after proai.cache.RecordCache.pollSeconds<br /><br />proai.writeLockWait = 60000<br /><br /># [proai.cacheBaseDir]<br /># The directory where cache files should be stored. This will be created <br /># if it doesn't exist.<br /><br />proai.cacheBaseDir = /tmp/proai/cache<br /><br /><br /># [proai.driverClassName]<br /># The class name of proai.driver.OAIDriver implementation. This should be <br /># in the classpath.<br /><br />proai.driverClassName = fedora.services.oaiprovider.FedoraOAIDriver<br /><br /><br /># [proai.driverPollSeconds]<br /># How often to poll the driver for updates.<br /><br />proai.driverPollSeconds = 60<br /><br /><br /># [proai.db.url]<br /># The JDBC connection URL for the database that will be used by the cache.<br /># [proai.db.driverClassName]<br /># The class name of the JDBC driver appropriate for use with the<br /># connection url. This class should be in the classpath.<br /># [proai.db.username]<br /># The database user. This user should already exist in the database<br /># and must have permission to create, modify, and query tables.<br /># [proai.db.password]<br /># The password for the database user.<br /><br /># MySQL<br />proai.db.url = jdbc:mysql://localhost/proai?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;autoReconnect=true<br />proai.db.driverClassName = com.mysql.jdbc.Driver<br /><br /># McKoi<br />#proai.db.url = jdbc:mckoi:local://build/test/mckoi/mckoi.conf?create_or_boot=true<br />#proai.db.driverClassName = com.mckoi.JDBCDriver<br /><br />proai.db.username = proai<br />proai.db.password = proai<br /><br /># [JDBC Driver-specific DDL Converters]<br /># A ddlConverter class is used to generate the commands necessary for <br /># creating the tables required Proai's record cache. The name of the <br /># property should be the driverClassName of the JDBC driver you're using<br /># plus ".ddlConverter".<br />com.mckoi.JDBCDriver.ddlConverter = proai.util.McKoiDDLConverter<br />com.mysql.jdbc.Driver.ddlConverter = proai.util.MySQLDDLConverter<br />oracle.jdbc.driver.OracleDriver.ddlConverter = proai.util.OracleDDLConverter<br /><br />#################################<br /># OAIDriver-Specific Properties #<br />#################################<br /><br />driver.fedora.baseURL = http://localhost:8080/fedora/<br />driver.fedora.user = fedoraAdmin<br />driver.fedora.pass = fedoraAdmin<br /><br /># [driver.fedora.queryConnectionTimeout]<br /># When querying the resource index, the maximum number of seconds to<br /># wait for the http connection to be established before giving up.<br />driver.fedora.queryConnectionTimeout = 30<br /><br /># [driver.fedora.querySocketTimeout]<br /># When querying the resource index, the maximum number of seconds of<br /># socket inactivity to allow before giving up.<br />driver.fedora.querySocketTimeout = 600<br /><br /># [driver.fedora.disseminationConnectionTimeout]<br /># When getting xml data from Fedora, the maximum number of seconds to<br /># wait for the http connection to be established before giving up.<br />driver.fedora.disseminationConnectionTimeout = 30<br /><br /># [driver.fedora.disseminationSocketTimeout]<br /># When getting xml data from Fedora, the maximum number of seconds of<br /># socket inactivity to allow before giving up.<br />driver.fedora.disseminationSocketTimeout = 120<br /><br />driver.fedora.queryFactory = fedora.services.oaiprovider.ITQLQueryFactory<br />driver.fedora.identify = http://localhost:8080/fedora/get/demo:MyRepository/Identify.xml<br /><br /># space-separated list of metadata formats<br />driver.fedora.md.formats = oai_dc test_format formatX formatY<br /><br />driver.fedora.md.format.oai_dc.loc = http://www.openarchives.org/OAI/2.0/oai_dc.xsd<br />driver.fedora.md.format.oai_dc.uri = http://www.openarchives.org/OAI/2.0/oai_dc/<br />driver.fedora.md.format.oai_dc.dissType = info:fedora/*/oai_dc<br /># optional<br />driver.fedora.md.format.oai_dc.about.dissType = info:fedora/*/about_oai_dc<br />driver.fedora.md.format.formatX.about.dissType = info:fedora/*/demo:XYFormatsBDef/getMetadataAbout?format=x<br />driver.fedora.md.format.formatY.about.dissType = info:fedora/*/demo:XYFormatsBDef/getMetadataAbout?format=y<br /><br />driver.fedora.md.format.test_format.loc = http://example.org/testFormat.xsd<br />driver.fedora.md.format.test_format.uri = http://example.org/testFormat/<br />driver.fedora.md.format.test_format.dissType = info:fedora/*/test_format<br /><br />driver.fedora.md.format.formatX.loc = http://example.org/formatX.xsd<br />driver.fedora.md.format.formatX.uri = http://example.org/formatX/<br />driver.fedora.md.format.formatX.dissType = info:fedora/*/demo:XYFormatsBDef/getMetadata?format=x<br /><br />driver.fedora.md.format.formatY.loc = http://example.org/formatY.xsd<br />driver.fedora.md.format.formatY.uri = http://example.org/formatY/<br />driver.fedora.md.format.formatY.dissType = info:fedora/*/demo:XYFormatsBDef/getMetadata?format=y<br /><br />driver.fedora.itemID = http://www.openarchives.org/OAI/2.0/itemID<br />driver.fedora.setSpec = http://www.openarchives.org/OAI/2.0/setSpec<br />driver.fedora.setSpec.name = http://www.openarchives.org/OAI/2.0/setName<br />driver.fedora.setSpec.desc.dissType = info:fedora/*/SetInfo.xml<br /><br />driver.fedora.itemSetSpecPath = $item &lt;fedora-rels-ext:isMemberOf&gt; $set $set &lt;http://www.openarchives.org/OAI/2.0/setSpec&gt; $setSpec<br /><br /># optional oai-deleted property<br />#driver.fedora.deleted = info:fedora/fedora-system:def/model#state<br /><br /># optional volatile property<br />#driver.fedora.volatile = true<br /><br />#################################<br /># Advanced, Optional Properties #<br />#################################<br /><br /># [Advanced connection pool configuration]<br /># These properties map to those defined by the Apache commons-DBCP project,<br /># documented at http://jakarta.apache.org/commons/dbcp/configuration.html<br />#<br /># proai.db.defaultAutoCommit =<br /># proai.db.defaultReadOnly =<br /># proai.db.defaultTransactionIsolation =<br /># proai.db.defaultCatalog =<br /># proai.db.maxActive =<br /># proai.db.maxIdle =<br /># proai.db.minIdle =<br /># proai.db.initialSize =<br /># proai.db.maxWait =<br /># proai.db.testOnBorrow =<br /># proai.db.testOnReturn =<br /># proai.db.timeBetweenEvictionRunsMillis =<br /># proai.db.numTestsPerEvictionRun =<br /># proai.db.minEvictableIdleTimeMillis =<br /># proai.db.testWhileIdle =<br /># proai.db.validationQuery =<br /># proai.db.accessToUnderlyingConnectionAllowed =<br /># proai.db.removeAbandoned =<br /># proai.db.removeAbandonedTimeout =<br /># proai.db.logAbandoned =<br /># proai.db.poolPreparedStatements =<br /># proai.db.maxOpenPreparedStatements =<br />#<br /># [Connection-specific properties]<br /># These properties can be anything you want. Two examples follow.<br /># The name after "db.connection." should be the name of any <br /># connection-specific property.<br />#<br /># proai.db.connection.anyConnectionProperty = <br /># proai.db.connection.anyConnectionProperty2 = <br /><br /></pre>
<br />
</div>

</div>

</div>

<div id="footer">
<div id="copyright">Copyright &copy; 2006 Fedora
Project </div>

<div id="lastModified"> Last Modified
<script type="text/javascript">
//<![CDATA[
var cvsDate = "$Date$";
var parts = cvsDate.split(" ");
var modifiedDate = parts[1];
document.write(modifiedDate);
//]]>
</script>
</div>

</div>

</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
  <title>Fedora Installation and Configuration Guide</title>
  <link rel="stylesheet" type="text/css" href="../docstyle.css" />
</head>

<body>
<div id="header">
	<a href="../index.html" id="logo"></a>

    <div id="title">
		<h1>Fedora Installation and Configuration Guide</h1>
		<h2>Fedora Release 2.2</h2>
	</div>
</div>


<div id="toc">
    <h2>Table of Contents</h2>
    <div id="tocbox">
        <ol>
            <li><a href="#intro">Introduction</a>
            	<ol>
            		<li><a href="#intro.prereq">Prerequisites</a></li>
            		<li><a href="#intro.download">Download Fedora</a></li>
            		<li><a href="#intro.env">Environment Variables</a></li>
            	</ol>
            </li>
      		<li><a href="#installer">Installation</a>
      			<ol>
      				<li><a href="#installer.quick">Quick Install</a></li>
      				<li><a href="#installer.custom">Custom Install</a></li>
      				<li><a href="#installer.client">Client Install</a></li>
      			</ol>
      		</li>
       		<li><a href="#running">Running the Server</a>
       			<ol>
      				<li><a href="#running.demo">Demo Objects</a></li>
      			</ol>
       		</li>
            <li><a href="#database">Database</a>
            	<ol>
            		<li><a href="#database.mysql">MySQL</a></li>
            		<li><a href="#database.oracle">Oracle</a></li>
            		<li><a href="#database.postgresql">PostgreSQL</a></li>
            		<li><a href="#database.other">Other</a></li>
           		</ol>
            </li>
            <li><a href="#config">Configuring the Fedora Server</a>
            	<ol>
            		<li><a href="#config.fcfg">fedora.fcfg</a></li>
            		<li><a href="#config.log">Logging</a></li>
           		</ol>
            </li>
            <li><a href="#source">Installation from Source</a></li>
        </ol>
    </div>
</div>

<div class="sect">
	<h2><a name="intro">1. Introduction</a></h2>
	<p>This is the installation guide for Fedora. It includes instructions for 
	installing the server and client distributions, as well as instructions for 
	installing and compiling the complete source code distribution.</p>

    <div class="subsect">
		<h3><a name="intro.prereq">A. Install Prerequisites</a></h3>
    	<p>Required:</p>
        <ul>
        	<li>Java SE Development Kit (JDK) 5.0. <br /> 
        	Whether installing a binary or source distribution, JDK 5.0 is 
        	required. 
        	The JDK should be installed on the machine you intend to use as the 
        	Fedora server. The JDK is available from 
        	<a href="http://java.sun.com/">http://java.sun.com/</a>.</li>
        </ul>

		<p>Optional:</p>
        <ul>
			<li>Database<br /> 
			The Fedora server is backed in part by a relational database. 
			To simplify installation, the Fedora installer includes and can
			configure an embedded instance of the 
			<a href="http://mckoi.com/database/">McKoi SQL Database 1.0.3</a>. 
			Fedora also supports <a href="http://www.mysql.com/">MySQL</a>, 
			<a href="http://www.oracle.com/">Oracle 9</a> and 
			<a href="http://www.postgresql.org/">PostgreSQL</a>. 
			If the included McKoi database will not be used, another database 
			server must be installed, configured and running before proceeding 
			with the installation.
			To configure Fedora to use another database, please see the 
			<a href="#database">Database</a> section below for further 
			instructions.</li>
            <li>Servlet Container<br />
            The Fedora installer includes Tomcat 5.0.28. Optionally, Fedora may 
            be installed into any existing servlet container that implements 
            Servlet 2.4/JSP 2.0 or higher. At this time, Fedora has chiefly 
            been tested with Tomcat 5.0.28 but users have reported running 
            Fedora successfully with Tomcat 5.5.x and Jetty.
            </li>
        </ul>
        
        <p>Additional requirements for building Fedora from source:</p>
        <ul>
        	<li>Ant 1.6.5 or later<br /> 
        	Fedora uses Ant for its build environment. Ant is available from 
        	<a href="http://ant.apache.org/">http://ant.apache.org/</a>.</li>
        </ul>
    </div>

    <div class="subsect">
		<h3><a name="intro.download">B. Download Fedora</a></h3>
		<p>The latest version of the software can always be found at
		<a href="http://www.fedora.info/download/" 
		target="_top">http://www.fedora.info/download/</a>.</p>

		<p>There are two download options: the Fedora Installer and the source 
		code distribution. Unless you wish to build Fedora from source, you 
		should select the Fedora Installer.</p>
    </div>
    
    <div class="subsect">
		<h3><a name="intro.env">C. Prepare Environment Variables</a></h3>
		<p>The following environment variables must be correctly defined:</p>
		<dl>
			<dt>JAVA_HOME</dt>
				<dd><p>This should point to the base directory of your Java 
				installation. On Windows systems, this might be C:\java.
				For UNIX derivatives, this might be something like 
				/usr/local/java-1.5.0-sun</p></dd>

			<dt>FEDORA_HOME</dt>
				<dd><p>This is the directory where Fedora will be installed,
				for example, C:\fedora or /usr/local/fedora.</p></dd>
			<dt>PATH</dt>
				<dd><p>This must include the Java and Fedora bin directories. 
				For UNIX derivatives, this will be $FEDORA_HOME/server/bin, 
				$FEDORA_HOME/client/bin and usually $JAVA_HOME/bin.
				For Windows, this will be %FEDORA_HOME%\server\bin, 
				%FEDORA_HOME%\client\bin and usually %JAVA_HOME%\bin.</p>
				<p>If you will be building from source, Ant should also also be
				on your path.</p></dd>
			<dt>JAVA_OPTS</dt>
				<dd><p>If Fedora is configured to use SSL, JAVA_OPTS must 
				include the <code>javax.net.ssl.trustStore</code> and 
				<code>javax.net.ssl.trustStorePassword</code> properties.
				See the SSL section below for more information.</p></dd>
			<dt>CATALINA_HOME</dt>
				<dd><p>If Fedora is configured to use Tomcat, CATALINA_HOME 
				must be set before starting Fedora. If using the quick install 
				option, CATALINA_HOME should be set to 
				$FEDORA_HOME/tomcat (or %FEDORA_HOME%\tomcat in Windows).</p></dd>
		</dl>
    </div>
</div>

<div class="sect">
	<h2><a name="installer">2. Installation</a></h2>
	<p>The Fedora Installer provides three installation options: quick, custom, 
	and client.</p>

	<p>To start the installer, change to the directory where you downloaded the 
	installer and at a command prompt, enter</p>
	<div class="code">java -jar fedora-2.2-installer.jar</div>
	
	<p>Please ensure that the user account that is running the installer has 
	sufficient permissions to write to the directories where Fedora will be 
	installed (if deploying to an existing Tomcat installation, this includes 
	permissions to the Tomcat directory).</p>
	
    <div class="subsect">
		<h3><a name="installer.quick">A. Quick</a></h3>
		<p>The quick option is designed to get Fedora up and running as quickly 
		as possible, with a minimum of advanced options. 
		The quick install will automatically install a servlet container and 
		database.
		Neither SSL support nor XACML policy enforcement is enabled by the 
		quick install.</p>
	</div>
	
	<div class="subsect">
		<h3><a name="installer.custom">B. Custom</a></h3>
		<p>The custom option provides the most flexibility in configuring an 
		installation. Options include the choice of servlet container,
		database, the host and ports Fedora will be running on, as well as 
		security options including SSL and XACML policy enforcement.</p>
		
		<dl>
			<dt>Servlet Container</dt>
			<dd><p>The installer will automatically configure and deploy to 
			Tomcat 5.0.x and 5.5.x servlet containers. 
			However, if an existing Tomcat installation (as opposed to the 
			Tomcat bundled with the installer) was selected, the installer will 
			not overwrite your existing <code>server.xml</code>, but rather, 
			place a modified copy at <code>FEDORA_HOME/install</code> so that 
			you may review it before before installing it yourself.</p>
			<p>Other servlet containers will require manual deployment of the 
			.war files located at <code>FEDORA_HOME/install</code>.</p></dd>
		
			<dt>SSL</dt>
			<dd><p>Configuring SSL support for Fedora's API-M interface is 
			strongly recommended for production environments.</p>
			<p>If the Tomcat servlet container is selected, the installer will 
			configure <code>server.xml</code> for you. However, as noted above, 
			if an existing Tomcat installation was selected, the installer will 
			not overwrite your existing <code>server.xml</code>.</p>
			<p>Please consult your servlet container's documentation 
			for certificate generation and installation. (In particular, the 
			example certificate provided by the installer for Tomcat should not 
			be used in a production environment).</p>
			<p>If Fedora is configured to use SSL, the <code>JAVA_OPTS</code> 
			environment variable must include the 
			<code>javax.net.ssl.trustStore</code> and 
			<code>javax.net.ssl.trustStorePassword</code> properties.
			The value of <code>javax.net.ssl.trustStore</code> should be the 
			location of the truststore file and the value of 
			<code>javax.net.ssl.trustStorePassword</code> is the password for 
			the keystore. The following values may be used with the sample 
			keystore included with the installer: </p>
			<div class="code">-Djavax.net.ssl.trustStore=$FEDORA_HOME/server/truststore
-Djavax.net.ssl.trustStorePassword=tomcat</div></dd>
		</dl>
	</div>
	
	<div class="subsect">
		<h3><a name="installer.client">C. Client</a></h3>
		<p>Both the quick and custom options will install the Fedora client 
		software in addition to the Fedora server. The client option, however, 
		will install only the Fedora client software.</p>
	</div>
</div>

<div class="sect">
	<h2><a name="running">3. Running Fedora</a></h2>
	<p>If you selected the quick install option, you will find Tomcat 
	installed in FEDORA_HOME/tomcat. To run Fedora, start Tomcat by entering</p>
	<div class="code">$FEDORA_HOME/tomcat/bin/startup.sh</div> 
	<p>(or for Windows)</p> 
	<div class="code">%FEDORA_HOME%\tomcat\bin\startup.bat</div>

	<p>If you selected the custom install option, ensure that your database 
	server is running (unless you selected the embedded McKoi option) and start 
	your servlet container if necessary.</p>
	
	<div class="subsect">
		<h3><a name="running.demo">A. Demo Objects</a></h3>
		<p>If you just started Fedora for the first time, it's a
		good idea to check out the demonstration objects to get an idea of how 
		Fedora works. See <a href="demos.html">the Demo Manual</a> for complete 
		descriptions of the demos.</p>
		
		<p>NOTE: If, during a custom install, you entered values other than 
		the defaults for <em>fedoraServerHost</em> (localhost) or 
		<em>fedoraServerPort</em> (8080), you must run the 
		<i><b>demo object converter utility</b></i> script to change the host 
		and/or port in the demo object ingest files.
		The demo object conversion is only required if you are ingesting demo 
		objects. If the demo objects are already ingested into the repository 
		(e.g. from a previous installation), there is no need for conversion. 
		The demo objects are shipped with references to 
		&quot;localhost:8080&quot; and these references must reflect the new 
		values of <em>fedoraServerHost</em> <em>fedoraServerPort</em>.
		Refer to the 
		<a href="../client/cmd-line/index.html">Command-line Utilities documentation</a> 
		for additional details on running the demo object converter.</p>
    
	    <p>To ingest the demos, at a command prompt, enter:</p>
	
		<div class="code">fedora-ingest-demos [hostname] [port] [username] [password] [protocol]</div>
	
	    <p>For additional information on the fedora-ingest-demos command,
	    see the documentation for the <a href="../client/cmd-line/index.html#indemo">
	    client command-line utilities</a>. Please note that 
	    the demo objects must be ingested before they can be discovered 
	    using the default search interface.</p>
		</div>
</div>

<div class="sect">
	<h2><a name="database">4. Database</a></h2>
	<p>Fedora is designed to be RDBMS-independent. Fedora has been tested with 
	McKoi, MySQL, Oracle and PostgreSQL. The embedded version of McKoi included 
	with the installer is provided as a convenience. Large repositories or 
	repositories concerned with scalability and performance should consider 
	using an alternative database. If you choose to use any database other 
	than the embedded McKoi provided by the Fedora Installer, we assume here 
	that the database is already installed.</p>

	<p>Follow the instructions below for the RDBMS of your choice in order to 
	create the user and tables required by Fedora.</p>
	
	<div class="subsect">
		<h3><a name="database.mysql">A. MySQL</a></h3>
		<p>Please note that the MySQL JDBC driver provided by the installer 
		requires MySQL v3.23.x or higher.</p>
		
		<p>The MySQL commands listed below can be run within the 
		<code>mysql</code> program, which may be invoked as follows:</p>
		<div class="code">mysql -u root -p</div>
		
		<p>Create the database. For example, to create a database named 
		<code>fedora22</code>, enter:</p>
		<div class="code">CREATE DATABASE fedora22;</div>
		
		<p>Set username, password and permissions for the database.
		For example, to set the permissions for user 
		<code>fedoraAdmin</code> with password <code>fedoraAdmin</code> on 
		database <code>fedora22</code>, enter:</p>
		<div class="code">GRANT ALL ON fedora22.* TO fedoraAdmin@localhost IDENTIFIED BY 'fedoraAdmin';
GRANT ALL ON fedora22.* to fedoraAdmin@'%' IDENTIFIED BY 'fedoraAdmin';</div>

		<p>MySQL 4.1.x users must also specify the default character set for the 
		Fedora database as "utf8" and the default collation as "utf8_bin". 
		For example, to set the default character set and collation on a 
		database named "fedora22", enter:</p>
		<div class="code">ALTER DATABASE fedora22 DEFAULT CHARACTER SET utf8;
ALTER DATABASE fedora22 DEFAULT COLLATE utf8_bin;</div>
	</div>
	
	<div class="subsect">
		<h3><a name="database.oracle">B. Oracle</a></h3>
		<p>To prepare Oracle for use with Fedora, the following steps should
           be taken by an administrative user.</p>
        <p>First, using the Database Configuration Assistant, ensure that the 
           database you'll be using is created with the UTF8 charset.</p>
        <p>Next, you'll need to create a Fedora tablespace and user in the 
           database.
           Assuming the administrative user is <code>sys</code> and the
           SID is <code>fedora22</code>, log in using SQL*Plus using the
           following command:
        </p>
        <div class="code">sqlplus sys/PASSWORD@fedora22 as sysdba</div>
        <p>To create a tablespace named <code>fedora_tblspace</code> with
        data in <code>/var/lib/oracle</code>, enter the following:</p>
        <div class="code">CREATE TABLESPACE fedora_tblspace
 DATAFILE '/var/lib/oracle/fedora_tblspace.dat' SIZE 1024M REUSE
 AUTOEXTEND ON NEXT 256M MAXSIZE UNLIMITED
 SEGMENT SPACE MANAGEMENT AUTO;</div>
        <p>To create a user <code>fedoraAdmin</code> with password
        <code>fedoraAdmin</code>, using the <code>fedora_tblspace</code>,
        enter the following:</p>
        <div class="code">CREATE USER fedoraAdmin IDENTIFIED BY fedoraAdmin
 DEFAULT TABLESPACE fedora_tblspace;</div>
        <p>Using the <code>GRANT</code> command, make sure the user has 
        permission to connect, create, alter, and drop tables sequences, 
        triggers, and indexes in this tablespaces.  For example,</p>
        <div class="code">GRANT ALL PRIVILEGES TO fedoraAdmin;</div>
		<p>NOTE: Due to distribution license restrictions, the Fedora Installer does 
		not include the Oracle JDBC driver. Oracle JDBC drivers are available
		from <a href="http://technet.oracle.com/software/tech/java/sqlj_jdbc/content.html"
		target="_top">http://technet.oracle.com/software/tech/java/sqlj_jdbc/content.html</a>.
        The installer will prompt you for the location of the driver on your 
        filesystem.</p>
	</div>
	
	<div class="subsect">
		<h3><a name="database.postgresql">C. PostgreSQL</a></h3>
		<p>Please consult the documentation at 
		<a href="http://www.postgresql.org/docs/">http://www.postgresql.org/docs/</a>
		for more detailed information about configuring PostgreSQL.</p>
		
		<p>Launch the PostgreSQL interactive terminal, <code>psql</code>, 
		(optionally appending the <code>-U</code> argument to connect as a
		different user).</p>
		<div class="code">psql -d postgres</div>
		
		<p>To create a user <code>fedoraAdmin</code> with password 
		<code>fedoraAdmin</code> and  database named <code>fedora22</code>, 
		enter the following:</p>
		<div class="code">CREATE ROLE "fedoraAdmin" LOGIN PASSWORD 'fedoraAdmin';
CREATE DATABASE "fedora22" WITH ENCODING='UTF8' OWNER="fedoraAdmin";</div>
	</div>
	
	<div class="subsect">
		<h3><a name="database.other">D. Other Databases</a></h3>
        <p>To use a database other than McKoi, MySQL, Oracle or PostgreSQL, 
        the database must support common SQL-92 syntax and you must a have a 
        JDBC version 3 driver available.</p>
        
        <p>The JDBC driver will need to be installed manually. For most 
        containers, the driver may be placed in the Fedora webapp's WEB-INF/lib 
        directory. For Tomcat 5.0.x, however, the driver should be installed to 
        TOMCAT_HOME/common/lib. The JDBC url will need to be configured 
        appropriately in the Fedora Server Configuration File.</p>

        <p>Upon startup, Fedora checks the database for all required tables. If 
        the tables do not exist, Fedora will them. Because table creation is 
        much less standardized task across RDBMSs than SQL queries you must do
        one of the following:</p>

		<ol>
			<li>Create the tables and indexes and auto-increments yourself in 
			your own database (see the file:
			src/dbspec/server/fedora/server/storage/resources/DefaultDOManager.dbspec
			in the source distribution for the RDBMS-neutral table 
			specifications).</li>

            <li>Write a subclass of fedora.utilities.DDLConverter for your 
            database software, include it in the Fedora WEB-INF/classes 
            directory or in a jar file in the Fedora WEB-INF/lib directory, and 
            associate it with the JDBC driver inside the 
            FEDORA_HOME/server/config/fedora.fcfg file
			(see how it's done by looking at the MySQLDDLConverter and 
			McKoiDDLConverter associations with their respective drivers in the 
			fedora.fcfg file, and the classes' implementations in the source
 			distribution).</li>
		</ol>

        <p>If you choose option #2, please tell us about it, as it will be 
        useful for other users of Fedora! Option 2 is harder, but it will make 
        future installations of new versions of Fedora (where the db schema will 
        likely change) much easier for you if you plan on using that database
        later.</p>
	</div>
</div>

<div class="sect">
	<h2><a name="config">5. Configuring the Fedora Server</a></h2>
	<div class="subsect">
		<h3><a name="config.fcfg">A. fedora.fcfg</a></h3>
		<p>The Fedora Server's configuration is chiefly governed by the Fedora 
		Server Configuration File (fedora.fcfg) located at 
		<code>FEDORA_HOME/server/config/fedora.fcfg</code>.</p>
	
		<p>The Fedora server configuration file contains: 
		(1) global parameters for the Fedora server, 
		(2) configuration parameters for each server module, and 
		(3) configuration parameters for each persistent data store.</p>

		<p>The configuration file has a simple schema. It starts with a server 
		element, under which a series of parameter elements occur, followed by a 
		series of module elements, followed by a series of datastore elements. 
		The parameter elements directly following the root server element are used 
		to control what are considered generic server functionality; for example: 
		the port on which the server is exposed.</p>

		<p>The module elements are used to configure specific parts
        of Fedora. For instance, the module with the role
        attribute, "fedora.server.search.FieldSearch" is used to
        configure the field-searching component of the server.
        Inside the module element, several param elements are
        included. These are specific to that module's
        implementation. Descriptions of each parameter can
        currently be found in the configuration file itself.</p>

		<p>The datastore elements are used to configure various
        databases that might be used by the system. Although the
        sample configuration file holds several, you will typically
        only need one. The datastore elements are associated with
        the modules by means of a parameter inside the associated
        module. In the sample configuration file, for example, the
        poolNames param of the
        fedora.server.storage.ConnectionPoolManager module refers
        to one of the datastore elements in its value.</p>
        
		<p>There are many other parameters you can configure with Fedora. 
		Refer to the Fedora Server Configuration File itself (fedora.fcfg) for 
		internal documentation on all the parameters.</p>
	</div>
	
	<div class="subsect">
		<h3><a name="config.log">B. Logging</a></h3>
		<p>Fedora uses Log4J for logging. For detailed information about using 
		Log4J, consult the Log4J Manual: 
		<a href="http://logging.apache.org/log4j/docs/manual.html">http://logging.apache.org/log4j/docs/manual.html</a>.</p>
		
		<p>The log configuration file is located at 
		<code>FEDORA_HOME/server/config/log4j.properties</code>. 
		Changes to the logging configuration will not be reflected until Fedora 
		is restarted.</p>
		
		<p>Normally, coarse-grained logs for Fedora are written to 
		<code>FEDORA_HOME/server/logs/fedora.log</code>. The following examples 
		show the kinds of configuration changes you can make to aid in 
		debugging.</p>

		<p>To change the level to DEBUG for all Fedora classes, change the 
		<code>log4j.logger.fedora</code> line to the following:</p>
		<div class="code">log4j.logger.fedora = DEBUG, FEDORA</div>
		
		<p>To change the level to DEBUG for just one class, add the following 
		lines:</p>
		<div class="code">log4j.logger.fedora.server.utilities.SQLUtility = DEBUG, FEDORA
log4j.additivity.fedora.server.utilities.SQLUtility = false</div>

		<p>To change the level to DEBUG for a whole package, add the following 
		lines:</p>
		<div class="code">log4j.logger.fedora.server.resourceIndex = DEBUG, FEDORA
log4j.additivity.fedora.server.resourceIndex = false</div>

		<p>To send all DEBUG messages for a package to STDERR, with methods and 
		line numbers add the following lines:</p>
		<div class="code">log4j.logger.fedora.server.security = DEBUG, SECURITY
log4j.additivity.fedora.server.security = false
log4j.appender.SECURITY = org.apache.log4j.ConsoleAppender
log4j.appender.SECURITY.target = System.err
log4j.appender.SECURITY.layout = org.apache.log4j.PatternLayout
log4j.appender.SECURITY.layout.ConversionPattern = %p %d{HH:mm:ss.SSS} [%t] (%c{1}.%M:%L) %m%n</div>
		
		<p>To send all DEBUG messages for a package to a dedicated file, with 
		methods and line numbers, add the following lines:</p>
		<div class="code">log4j.logger.fedora.server.security = DEBUG, SECURITY
log4j.additivity.fedora.server.security = false
log4j.appender.SECURITY = org.apache.log4j.RollingFileAppender
log4j.appender.SECURITY.File =
log4j.appender.SECURITY.MaxFileSize = 20MB
log4j.appender.SECURITY.MaxBackupIndex = 5
log4j.appender.SECURITY.layout = org.apache.log4j.PatternLayout
log4j.appender.SECURITY.layout.ConversionPattern = %p %d{HH:mm:ss.SSS} [%t] (%c{1}.%M:%L) %m%n</div>

		<p>Note: if <code>log4j.appender.SECURITY.File</code> is left empty, 
		the file will be automatically created at 
		<code>FEDORA_HOME/server/logs/security.log</code></p>
	</div>
	
</div>

<div class="sect">
	<h2><a name="source">6. Installation from Source</a></h2>
	
	<p>After unpacking the source distribution, change into the newly 
	extracted directory. To build the installer, at a command prompt, 
	enter</p>
	<div class="code">ant installer</div>
	<p>To see a list of build targets, at a command prompt, enter</p>
	<div class="code">ant -projecthelp</div>
</div>

<div id="footer">
    <div id="copyright">Copyright &copy; 2007 Fedora Project</div>

    <div id="lastModified">
      Last Modified <script type="text/javascript">
      //<![CDATA[
            var cvsDate = "$Date$";
            var parts = cvsDate.split(" ");
            var modifiedDate = parts[1];
            document.write(modifiedDate);
      //]]>
      </script>
    </div>
</div>
</body>
</html>
